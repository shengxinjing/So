# Javascript是一门语言

## 语言特征

 1. 解释性语言
 2. 弱类型
 3. 基于原型的继承
 4. 动态可变对象

## 词法结构

词法规则是一套基本规则，用来说明如何用这种语言来编写程序。

它是语言的最底层的规则，指定变量名是如何组成的，如何使用注释等。

1. 大小写敏感
2. 忽略空格、制表符，对换行符有一定的限制
3. 可选分号
4. 注释： 单行注释、块级注释
5. 字面量： 0、false、“yes”、{a：haha}、[1,2,3]、/regexp/ig、null
6. 标识符规则（用于变量名、函数名）： `/^[a-zA-Z$_][\w$]*$/`  
7. 保留字

## 数据类型和值

Javascript有基本类型和引用类型。

1. 使用64位来存储数字格式（浮点数运算问题），使用32位数字用于运算操作。
2. 特殊值：Infinity、NaN。
3. 函数是第一类对象，是数据类型。
4. 探测一个未声明的变量，使用 typeof 操作符，否则会报错
5. 数据自动转换（在表达式中），有两种状态，`字符串`状态和`数据`状态
6. 堆 和 栈的数据内存管理，以及引用机制

## 变量

通过 `var` 操作符声明的变量具有环境永久性，即变量是无法通过 `delete` 操作符来删除的。

全局变量同时是全局对象的属性，局部变量则是函数变量对象上的属性。变量对象(VO)在函数执行时创建，在程序无该变量对象的访问权限时释放（基于垃圾回收机制）。

同一函数在每次执行时，都会产生新的执行上下文和变量对象。每个执行环境都有一个与之对应的作用域链，该作用域链定义并控制了函数能够访问的消息。

作用域链是以变量对象为基本单元的链表。Javascript引擎在进行变量解析时，从作用域链中依次查找是否有同名变量；如果查找失败，则访问下一个变量对象，再次查找。如此下去，一直访问到链表的最后一项。如果仍然查找不到，程序就会抛出 Exception。

作用域与变量对象VO的关系：作用域是相对执行环境的抽象概念，表示执行环境中变量的作用范围；而变量对象是作用域概念的程序实现。

### with 语句

```javascript
with (obj) {
    // 在当前执行上下文的作用域链前端插入一个临时变量对象
    // 该变量对象在程序离开 with 语句块时被销毁
    // 该变量对象中的变量即 `obj` 中的属性，类似全局变量和全局对象的关系
    // 由于在一个可控对象上查找属性，因此会引入原型链查找机制
}
```

### try catch

```javascript
try {
    
} catch (e) {
    // 在 catch 语句块中，当前执行上下文的作用域链前端会被 push 入一个临时变量对象
    // 该变量对象只包含一个属性（变量），即 catch(`e`) 中的 e
    // 临时变量对象在程序离开 catch 语句块时移除
}
```

### blabla

作用域链：在当前执行上下文中定义一个函数，被定义的函数将会获得一个内置属性[[Scope]]，该属性存放了当前执行上下文的作用域链。函数的[[Scope]]是一个静态属性，即Javascript的作用域是词法作用域。

当函数被调用时，执行环境的作用域链由当前函数的变量对象 + 函数的[[Scope]] 组成。

## 表达式和运算符

Javascript解释器可以计算（evaluate）表达式，从而生成一个新的值。

最简单是表达式是 **字面量** 和 **变量名**，字面量表达式的值就是该字面量本身，变量表达式的值则是该变量所存放或引用的值。简单的表达式可以通过**运算符**合并以形成复杂的表达式。  

    expressiong = expression operate expression | literal | variable   ——猜的

运算符可以在一定意义上认为是函数的简化，一元、二元、三元运算符即指运算符执行运算操作时需要的数据个数，不同的运算符有不同的数据类型要求，并且返回单个结果。

    s = a * b   ——> s = sum(a, b)      

### 运算符的结合性：从左到右和从右到左

运算符的结合性说明在优先级相等时执行操作的顺序。

从左到右的结合性，比如加减法运算符
    
    s = a + b - c;

从右到左的结合性，比如赋值操作符

    x = y = z = 1;   等价 x = (y = (z = 1));

运算符 <= 和 >= 并不是依赖相等运算符和全等运算符来判断两个值是否相等，而只是将小于等于定义为“不大于”，将大于等于定义为“不小于”。特例是，当某个运算数是NaN，四个比较运算符都返回false。

 > 应尽量避免自动转换，增强对数据类型的控制


**逻辑 `&&`（`||`） 运算符**

 1. 首先，它将计算第一个运算数，也就是位于它左边的表达式。
 2. 如果该表达式的值可以被转换为false，则运算符返回该表达式的运算值。
 3. 否则，它将计算第二个运算数，即右边的表达式，并返回该表达式的运算值

```javascript
s = 0 && 4;   　        //0
s = null && 7;   　     //null
s = "" && 9     　　    //""
s = 1 && 9;    　　     //9
```

## 语句

虽然表达式中的运算符可以带来各种各样的副作用，但一般来说，表达式是什么都不做的。（这里的副作用是指表达式带来了变量值的改变，比如 = 、 ++、 += 等 ）

而Javascript语句 statement，就像一个完整的句子或命令。语句必须要求语法，开发人员只有遵循规范的语法（或称为句法），才能编写正确的程序。

    百度百科：
    语法分为句法和词法两个部分。
    句法研究的是句子的内部结构，以词作为基本单位；
    词法研究的是词的内部结构，以语素作为基本单位

最常见的是表达式语句，最基础的赋值运算、还有基于此衍生的复合赋值 +=、 递增运算 ++。还有 delete 运算、函数调用()运算。

### switch case 

`case` 语句后可以跟随任意的表达式，不仅仅限于数字和字符串字面量。

`switch` 语句首先计算 `switch` 关键字后的的表达式，然后按照程序定义顺序计算 `case` 后的表达式，直到找到与 `switch` 表达式的值相匹配的 `case` 表达式位置，使用 `===` 进行断言。

注意：用含有副作用的case表达式（如函数调用或赋值）不是好的程序设计习惯。因为每次执行switch语句时并不会计算所有的case表达式。当只有某些情况下出现副作用时，很难理解并预测程序的正确行为。

### Exception

`exception` 说明程序发生了某种异常或错误。

`throw` `exception`，就是用程序可控的方式通知开发者。
`catch` `exception`，就是处理它，即采用必要或适当的动作从异常恢复。

在抛出异常时，Javascript解释器会立刻停止正常的程序执行，跳转到最近的异常处理器。

异常处理器是用try/catch/finally 语句的catch 语句编写的。如果抛出异常的代码块没有相关的异常处理器，解释器将检查次高级的封闭代码块，看它是否有相关的异常处理器。以此类推，直到找到一个异常处理器为止。如果抛出异常的函数中没有处理异常的处理器，异常将向上传播到调用该函数的代码。在这种情况下，异常将沿着Javascript方法的**词法结构？？？**和调用上下文栈向上传播。如果没有找到任何异常处理器，将异常作为错误处理，报告给用户。
