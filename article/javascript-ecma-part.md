# Javascript是一门语言

## 语言特征

 1. 解释性语言
 2. 弱类型
 3. 基于原型的继承
 4. 动态可变对象

## 词法结构

词法规则是一套基本规则，用来说明如何用这种语言来编写程序。

它是语言的最底层的规则，指定变量名是如何组成的，如何使用注释等。

1. 大小写敏感
2. 忽略空格、制表符，对换行符有一定的限制
3. 可选分号
4. 注释： 单行注释、块级注释
5. 字面量： 0、false、“yes”、{a：haha}、[1,2,3]、/regexp/ig、null
6. 标识符规则（用于变量名、函数名）： `/^[a-zA-Z$_][\w$]*$/`  
7. 保留字

## 数据类型和值

Javascript有基本类型和引用类型。

1. 使用64位来存储数字格式（浮点数运算问题），使用32位数字用于运算操作。
2. 特殊值：Infinity、NaN。
3. 函数是第一类对象，是数据类型。
4. 探测一个未声明的变量，使用 typeof 操作符，否则会报错
5. 数据自动转换（在表达式中），有两种状态，`字符串`状态和`数据`状态
6. 堆 和 栈的数据内存管理，以及引用机制

## 变量

强类型语言的优点在于要求使用严格的程序设计规则，以便使编写、维护和重用那些较长、较复杂的程序变得容易。

通过 var 声明的变量具有环境永久性，即在所定义的作用域中，该变量无法通过delete删除。

全局变量是全局对象的属性(不可删除)，局部变量则是函数执行上下文中的变量对象的属性。变量对象在函数执行时创建，但在函数执行完成后可能会持续存在（如果这个函数是一个闭包的话）。

同一函数在每次执行时都会产生新的执行上下文和变量对象。因此，同一函数每次执行时的变量对象是相互独立的。同时，每个执行环境有一个和它关联的作用域链。作用域链是以变量对象为基本单元的链表。Javascript在执行变量名解析的过程中，从作用域链表中的首项开始查找是否有相同名称的变量；如果查找失败，则访问下一个链表所包含的变量对象，再次查找。如此下去，一直访问到链表的最后一项。如果仍然查找不到，则返回错误 Error。

作用域与变量对象VO的关系：作用域是一个相对执行环境的抽象概念，表示该执行环境中变量的作用范围；而变量对象VO是作用域概念的程序实现，在Javascript中使用变量对象机制来实现作用域。

作用域链的机制：每在当前执行环境中定义一个函数，被定义的函数将会获得一个内置[[Scope]]属性，该属性是作用域链机制的基础。函数的[[Scope]]属性存放了当前执行上下文的作用域链。请注意，函数的[[Scope]]属性是一个静态属性，存放函数所定义时所处上下文的作用域链。

每次函数被调用，所创建的执行环境的作用域链都会将该执行环境的变量对象VO 增加到该函数[[Scope]]所存储的作用域链的前端，形成一个新作用域链。这就是Javascript作用域的工作机制。由此，我们可知，函数所能访问的作用域由函数的声明位置决定，而非函数的调用位置决定。

## 表达式和运算符

表达式是Javascript的短语，Javascript解释器可以计算它（evaluate），从而生成一个值。

最简单是表达式是字面量和变量名，字面量表达式的值就是该字面量本身，变量表达式的值则是该变量所存放或引用的值。简单的表达式可以通过运算符合并以形成复杂的表达式。  

    expressiong = expression operate expression | literal | variable   ——猜的

运算符可以在一定意义上认为是函数的简化，一元、二元运算符是指运算符执行运算操作时需要的数据个数，不同的运算符有不同的数据类型要求，并且返回唯一结果。

    s = a * b   ——> s = sum(a, b)      

运算符的结合性：有从左到右和从右到左两种结合方式。

运算符的结合性说明在优先级相等时执行操作的顺序。

从左到右的结合性表示操作从左到右执行，比如一般加减法运算。
又比如 x = y = z =1; 从右到左，等价于 x = (y = (z = 1));

比如：在 + 运算符中， 两个运算符分别是数字和对象。应手动地先将对象转换为一个数字再进行运算，或者显式定义对象的 valueOf() 函数，或者使用注释方式说明你希望程序如何执行，来尽可能地帮助开发人员理解程序。尽量避免对象的 valueOf() 方法无效而fallback至 toString() 方法，这样会导致不可预测和难以阅读。

运算符 <= 和 >= 并不是依赖相等运算符和全等运算符来判断两个值是否相等，而只是将小于等于定义为“不大于”，将大于等于定义为“不小于”。特例是，当某个运算数是NaN，四个比较运算符都返回false。

所谓的自动转换类型的实质在于，Javascript在后台运算之前，多经过了一步预处理用于隐式转换数据类型，然后像强类型语言一般进行正常运算。尽管对于开发人员来说，这个转换是透明的，但是这个转换也变得更为不可控和难以理解，开发人员因尽量避免自动转换。

在Javascript中不同的逻辑运算符：

比如逻辑 `&&` 运算符，首先，它将计算第一个运算数，也就是位于它左边的表达式。如果这个表达式的值可以被转换为false，那么运算符将返回左边表达式的值。否则，它将计算第二个运算数，就是位于右边的表达式，并返回这个表达式的值。

```javascript
s = 0 && 4;   　        //0
s = null && 7;   　     //null
s = "" && 9     　　    //""
s = 1 && 9;    　　     //9
```

对于逻辑非操作，我们会常用于 max = max-width || default.width || 500;   

## 语句

虽然表达式中的运算符可以带来各种各样的副作用，但一般来说，表达式是什么都不做的。（这里的副作用是指表达式带来了变量值的改变，比如 = 、 ++、 += 等 ）

而Javascript语句 statement，就像一个完整的句子或命令。语句必须要求语法，开发人员只有遵循规范的语法（或称为句法），才能编写正确的程序。

    百度百科：
    语法分为句法和词法两个部分。
    句法研究的是句子的内部结构，以词作为基本单位；
    词法研究的是词的内部结构，以语素作为基本单位

最为常见的也是最为简单是表达式语句，最基础的赋值运算、还有基于此衍生的复合赋值 +=、 递增运算 ++。还有 delete 运算、函数调用()运算。

Javascript  switch case 语句有些不同之处，其case 语句后可以跟随任意的表达式，不仅仅限于数字和字符串字面量。

switch语句首先计算switch关键字后的的表达式，然后按照出现的顺序计算case后的表达式，直到找到与switch表达式的值相匹配的case表达式位置。其匹配判定是用 全等=== 运算符进行判断的。

注意：用含有副作用的case表达式（如产生函数调用或赋值）不是好的程序设计习惯。因为每次执行switch语句时并不会计算所有的case表达式。当只有某些情况下出现副作用时，很难理解并预测程序的正确行为。

for 循环和 while 循环之间的差异在于 for 循环语法将所有有关循环变量的重要信息都放置在一行中，执行体放置在语句块中，这使得循环逻辑显得更加清晰。

从技术上说，function语句并非是一个语句。在Javascript程序中，语句会引发动态的行为，当时函数定义描述的却是静态的程序结构。语句是在运行时执行的，而函数则是在实际运行之前（在进入执行代码前，在上下文创建期间被定义），当Javascript代码被解析或者编译时定义的。当Javascript解析程序遇到一个函数定义时，它就解析并存储（而无需执行）构成函数主体的语句，然后定义一个和该函数同名的属性（如果该函数定义嵌套在其他函数中，那么就在VO中定义这个属性，否则在全局对象中定义这个属性）以保存它。 

所谓异常（exception）是一个信号，说明发生了某种异常状况或错误。抛出throw一个异常，就是用信号通知发生了错误或异常状况。捕捉catch一个异常，就是处理它，即采用必要或适当的动作从异常回复。

在抛出异常时，Javascript解释器会立刻停止正常的程序执行，跳转到最近的异常处理器。异常处理器是用try/catch/finally 语句（Javascript的异常处理机制）的catch 语句编写的。如果抛出异常的代码块没有相关的异常处理器，解释器将检查次高级的封闭代码块，看它是否有相关的异常处理器。以此类推，直到找到一个异常处理器为止。如果抛出异常的函数中没有处理异常的处理器，异常将向上传播到调用该函数的代码。在这种情况下，异常将沿着Javascript方法的词法结构和调用上下文堆栈向上传播。如果没有找到任何异常处理器，将异常作为错误处理，报告给用户。关于异常处理机制——可以再进行详细研究。
